<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Solving Inequalities</title>

  <style>
    /* ============================================================
      THEME TOKENS
    ============================================================ */
    :root {
      --top-bar-bg: #34495e;
      --bottom-bar-bg: #2c3e50;
      --page-bg: #f7f4e9;

      --card-bg: #ffffff;
      --card-border: #1f7ed0;

      --text-main: #1f2933;
      --text-muted: #ecf0f1;

      --pill-blue: #3498db;
      --pill-green: #27ae60;
      --pill-red: #e74c3c;
      --pill-purple: #8e44ad;
      --pill-yellow: #f1c40f;
      --pill-orange: #e67e22;

      --toolbar-icon-bg: #f1c40f;
      --toolbar-icon-border: #e0a708;

      --shadow-soft: 0 6px 18px rgba(0, 0, 0, 0.12);
      --radius-card: 18px;
      --radius-pill: 999px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--page-bg);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ============================================================
      TOP BAR
    ============================================================ */
    .top-bar {
      background: var(--top-bar-bg);
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 24px;
      font-size: 14px;
    }
    .top-left { display: flex; flex-direction: column; gap: 6px; }
    .meta-row { display: flex; align-items: baseline; gap: 6px; }
    .meta-label { font-weight: 600; opacity: 0.9; }
    .meta-value {
      border-bottom: 2px solid rgba(236, 240, 241, 0.7);
      padding-bottom: 2px;
      font-weight: 500;
    }
    .top-right { display: flex; align-items: center; gap: 18px; font-weight: 500; }
    .page-info { white-space: nowrap; }

    .slide-select-wrapper { position: relative; }
    .slide-select {
      padding: 6px 28px 6px 10px;
      border-radius: 6px;
      border: none;
      font-size: 13px;
      font-weight: 500;
      outline: none;
      background: #ffffff;
      color: #333;
      appearance: none;
    }
    .slide-select-wrapper::after {
      content: "‚ñæ";
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 10px;
      pointer-events: none;
      color: #555;
    }

    /* ============================================================
      MAIN CONTENT AREA
    ============================================================ */
    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      padding: 40px 24px 40px;
      gap: 18px;
      position: relative;
    }

    /* ============================================================
      CARD COMPONENT
    ============================================================ */
    .card {
      background: var(--card-bg);
      border-radius: var(--radius-card);
      border: 3px solid var(--card-border);
      box-shadow: var(--shadow-soft);
      max-width: 900px;
      width: 100%;
      padding: 26px 34px 30px;
    }

    .card h1 {
      font-size: 30px;
      margin-bottom: 12px;
      font-weight: 800;
      color: #2c3e50;
    }

    .card p { font-size: 18px; line-height: 1.6; }

    .example-card p { font-size: 16px; line-height: 1.55; }

    .bullets {
      margin-top: 8px;
      padding-left: 18px;
      font-size: 18px;
      line-height: 1.6;
    }
    .bullets li { margin: 6px 0; }

    /* ============================================================
      CORE KNOWLEDGE LAYOUT (NO HANDWRITTEN NOTES BOX)
    ============================================================ */
    .core-knowledge-container {
      max-width: 900px;
      width: 100%;
    }

    .core-left {
      background: var(--card-bg);
      border-radius: var(--radius-card);
      border: 3px solid var(--card-border);
      box-shadow: var(--shadow-soft);
      padding: 26px 34px 30px;
    }

    .core-left h1 {
      font-size: 28px;
      margin-bottom: 12px;
      font-weight: 800;
      color: #2c3e50;
    }

    .question-box {
      background: var(--card-bg);
      border-radius: var(--radius-card);
      border: 3px solid #9b59b6;
      box-shadow: var(--shadow-soft);
      padding: 20px 28px;
      margin-top: 18px;
    }

    .question-box h2 {
      font-size: 22px;
      font-weight: 800;
      color: #2c3e50;
      margin-bottom: 10px;
    }

    .question-content {
      font-family: "Times New Roman", Times, serif;
      font-size: 36px;
      line-height: 1.3;
    }

    /* ============================================================
      NUMBER LINE
    ============================================================ */
    .number-line-container {
      margin-top: 20px;
      padding: 20px;
    }

    .number-line {
      position: relative;
      height: 60px;
      margin: 30px 0;
    }

    .number-line-axis {
      position: absolute;
      top: 30px;
      left: 10%;
      right: 10%;
      height: 3px;
      background: #000;
    }

    .number-line-arrow {
      position: absolute;
      top: 30px;
      right: 10%;
      width: 0;
      height: 0;
      border-left: 12px solid #000;
      border-top: 8px solid transparent;
      border-bottom: 8px solid transparent;
    }

    .number-line-point {
      position: absolute;
      top: 30px;
      transform: translate(-50%, -50%);
    }

    .number-line-point.open {
      width: 16px;
      height: 16px;
      border: 3px solid #000;
      border-radius: 50%;
      background: white;
    }

    .number-line-point.closed {
      width: 16px;
      height: 16px;
      background: #000;
      border-radius: 50%;
    }

    .number-line-label {
      position: absolute;
      top: 50px;
      transform: translateX(-50%);
      font-size: 18px;
      font-weight: 600;
    }

    .number-line-shade {
      position: absolute;
      top: 27px;
      height: 9px;
      background: rgba(52, 152, 219, 0.3);
    }

    /* ============================================================
      MATH TYPOGRAPHY
    ============================================================ */
    .math { font-size: 52px; line-height: 1.25; }
    .math i { font-style: italic; }
    .math sup { font-size: 60%; vertical-align: super; }

    .equation-line {
      display: flex;
      align-items: baseline;
      gap: 14px;
      margin: 22px 0;
    }

    /* ============================================================
      WORKED EXAMPLE GRID LAYOUT
    ============================================================ */
    .worked-example {
      display: grid;
      grid-template-columns: auto auto auto;
      gap: 8px 20px;
      align-items: baseline;
      justify-content: start;
      font-family: "Times New Roman", Times, serif;
      font-size: 36px;
      line-height: 1.4;
      margin-top: 12px;
    }

    .worked-example .lhs {
      text-align: right;
      justify-self: end;
      color: #000000;
    }

    .worked-example .sign {
      text-align: center;
      justify-self: center;
      min-width: 40px;
      color: #000000;
    }

    .worked-example .rhs {
      text-align: left;
      justify-self: start;
      color: #000000;
    }

    .worked-example .operation {
      font-size: 28px;
      color: #e74c3c;
    }

    .worked-example .fraction-display {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      vertical-align: middle;
    }

    .worked-example .fraction-line {
      border-top: 2px solid #e74c3c;
      width: 100%;
      margin: 2px 0;
    }

    .worked-example .numerator {
      color: #000000;
    }

    .worked-example .denominator {
      color: #e74c3c;
      font-size: 28px;
    }

    .worked-example .denominator.black {
      color: #000000;
    }

    .worked-example .fraction-line.black {
      border-top: 2px solid #000000;
    }

    .worked-example .bracket-notation {
      color: #e74c3c;
    }

    .worked-example .red-multiplier {
      color: #e74c3c;
    }

    .worked-example .red-bracket {
      color: #e74c3c;
    }

    .worked-example .red-dot {
      color: #e74c3c;
    }

    /* ============================================================
      TWO COLUMN TEACHER EXAMPLES
    ============================================================ */
    .teacher-examples-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      max-width: 1100px;
      width: 100%;
      margin-top: 18px;
    }

    .teacher-example-col {
      background: var(--card-bg);
      border-radius: var(--radius-card);
      border: 3px solid var(--card-border);
      box-shadow: var(--shadow-soft);
      padding: 20px 28px;
    }

    .teacher-example-col h2 {
      font-size: 22px;
      font-weight: 800;
      color: #2c3e50;
      margin-bottom: 12px;
    }

    /* ============================================================
      QUESTION LABELS
    ============================================================ */
    .q-label {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 22px;
      font-weight: 800;
      color: #2c3e50;
      width: 44px;
      text-align: right;
      flex: 0 0 auto;
    }

    /* ============================================================
      MINI-WHITEBOARD (2x2 GRID - SPLIT INTO TWO SLIDES)
    ============================================================ */
    .questions-grid {
      max-width: 900px;
      width: 100%;
      padding: 0 34px;
      margin-top: 14px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      column-gap: 120px;
      row-gap: 160px;
      justify-items: start;
    }

    .q-block {
      font-family: "Times New Roman", Times, serif;
      font-size: 52px;
      line-height: 1.25;
      display: flex;
      align-items: baseline;
      gap: 14px;
    }

    /* ============================================================
      EXAMPLE SLIDES (ROW LAYOUT)
    ============================================================ */
    .questions-rows {
      max-width: 900px;
      width: 100%;
      padding: 0 34px;
      margin-top: 14px;
      display: flex;
      flex-direction: column;
      gap: 70px;
    }

    .q-row {
      display: flex;
      align-items: baseline;
      gap: 14px;
    }

    .q-content {
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-width: 0;
    }

    .q-main {
      font-family: "Times New Roman", Times, serif;
      font-size: 52px;
      line-height: 1.25;
    }

    .q-sub {
      font-family: "Times New Roman", Times, serif;
      font-size: 34px;
      line-height: 1.25;
    }

    .q-row.placeholder { opacity: 0; pointer-events: none; }

    /* ============================================================
      FINAL REVIEW SLIDE
    ============================================================ */
    .review-slide {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
      margin-top: 6px;
    }

    .review-title {
      border: 3px solid #f59e0b;
      background: #fff7ed;
      color: #c2410c;
      font-size: 26px;
      font-weight: 900;
      padding: 14px 18px;
      border-radius: 12px;
      box-shadow: var(--shadow-soft);
      width: 100%;
      max-width: 900px;
    }

    .review-box {
      border: 3px solid #3b82f6;
      background: #ffffff;
      padding: 16px 18px;
      border-radius: 12px;
      font-size: 18px;
      line-height: 1.5;
      box-shadow: var(--shadow-soft);
      width: 100%;
      max-width: 900px;
    }

    .review-box strong { font-weight: 900; }

    .review-example {
      margin-top: 8px;
      text-align: center;
      font-family: "Times New Roman", Times, serif;
      font-size: 28px;
      font-weight: 700;
    }

    .apply-task {
      border: 3px solid #16a34a;
      background: #ecfdf5;
      padding: 20px 18px;
      border-radius: 14px;
      box-shadow: var(--shadow-soft);
      width: 100%;
      max-width: 900px;
      text-align: center;
    }
    .apply-task h2 {
      color: #166534;
      font-size: 32px;
      margin-bottom: 8px;
      font-weight: 900;
    }
    .apply-task p {
      font-size: 20px;
      color: #14532d;
      font-weight: 700;
    }

    /* ============================================================
      TIMER WIDGET
    ============================================================ */
    .timer-widget {
      position: absolute;
      left: 24px;
      top: 110px;
      width: 260px;
      background: #111;
      color: #fff;
      border-radius: 14px;
      padding: 18px 16px 16px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.18);
      border: 3px solid #0ea5e9;
      user-select: none;
      z-index: 5;
      cursor: grab;
    }
    .timer-widget:active { cursor: grabbing; }

    .timer-display {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 48px;
      letter-spacing: 2px;
      text-align: center;
      margin-bottom: 12px;
    }
    .timer-controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-bottom: 12px;
    }
    .timer-btn {
      background: #2d9cdb;
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 8px 12px;
      font-weight: 800;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    }
    .timer-btn:active { transform: translateY(1px); }
    .timer-inputs {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      font-weight: 700;
    }
    .timer-inputs label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
    }
    .timer-inputs input {
      width: 56px;
      padding: 6px 8px;
      border-radius: 8px;
      border: 2px solid rgba(255,255,255,0.25);
      outline: none;
      font-weight: 800;
      text-align: center;
      background: #fff;
      color: #111;
    }

    /* ============================================================
      DRAWING CANVAS OVERLAY
    ============================================================ */
    #drawCanvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    /* ============================================================
      BOTTOM TOOLBAR - UPDATED STYLES
    ============================================================ */
    .toolbar {
      background: var(--bottom-bar-bg);
      color: var(--text-muted);
      padding: 10px 14px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
      flex-wrap: wrap;
    }
    .toolbar-left, .toolbar-right {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .tool-button, .pill-button {
      border: none;
      outline: none;
      cursor: pointer;
      font: inherit;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
    }
    
    /* CIRCULAR PEN BUTTON STYLES */
    .pen-circle {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
      transition: transform 0.1s;
      border: 3px solid transparent;
    }
    
    .pen-circle:hover {
      transform: translateY(-2px);
    }
    
    .pen-circle:active {
      transform: translateY(0);
    }
    
    .pen-circle.active {
      border: 3px solid #ffffff;
      box-shadow: 0 0 0 2px #f1c40f, 0 3px 8px rgba(0,0,0,0.3);
    }
    
    #blackPenBtn {
      background: #1a1a1a;
    }
    
    #yellowPenBtn {
      background: #f1c40f;
    }
    
    #greenPenBtn {
      background: #27ae60;
    }
    
    #redPenBtn {
      background: #e74c3c;
    }
    
    #highlighterBtn {
      background: #ffeb3b;
    }
    
    #eraserBtn {
      background: #ecf0f1;
    }
    
    .tool-button {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: #1f4b6f;
      color: #ecf0f1;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.35);
    }
    .tool-button.square-active {
      width: 40px;
      border-radius: 12px;
      background: var(--toolbar-icon-bg);
      color: #2c3e50;
      border: 2px solid var(--toolbar-icon-border);
      font-size: 18px;
    }
    .tool-button.disabled { opacity: 0.4; cursor: default; pointer-events: none; }

    .pill-button {
      padding: 7px 14px;
      border-radius: var(--radius-pill);
      font-weight: 700;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.35);
    }
    .pill-blue { background: var(--pill-blue); color: #ecf0f1; }
    .pill-red { background: var(--pill-red); color: #ffffff; }
    .pill-purple { background: var(--pill-purple); color: #ecf0f1; }
    .pill-green { background: var(--pill-green); color: #ecf0f1; }
    .pill-orange { background: var(--pill-orange); color: #ffffff; }
    .toolbar-spacer { flex: 1; }

    .wrap-ans {
      display: inline-block;
      max-width: 540px;
      vertical-align: top;
    }

    .hidden { display: none; }

    /* Two-method layout for brackets review */
    .two-methods-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-top: 8px;
    }

    .method-box {
      text-align: center;
    }

    .method-title {
      font-weight: 700;
      font-size: 20px;
      margin-bottom: 8px;
    }

    /* ============================================================
      RESPONSIVE BEHAVIOR
    ============================================================ */
    @media (max-width: 1100px) {
      .teacher-examples-container {
        grid-template-columns: 1fr;
      }
      .two-methods-container {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 900px) {
      .timer-widget {
        position: static;
        width: 100%;
        max-width: 360px;
        margin-bottom: 14px;
        cursor: default;
      }
      .questions-grid {
        grid-template-columns: 1fr;
        row-gap: 70px;
        column-gap: 0;
      }
      .math, .q-block { font-size: 42px; }
      .q-main { font-size: 42px; }
      .q-sub { font-size: 30px; }
    }
  </style>

  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(','\\)'], ['$', '$']] }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
  <header class="top-bar">
    <div class="top-left">
      <div class="meta-row">
        <span class="meta-label">Date:</span>
        <span class="meta-value">26/01/2026</span>
      </div>
      <div class="meta-row">
        <span class="meta-label">Title:</span>
        <span class="meta-value">Solving Inequalities</span>
      </div>
    </div>

    <div class="top-right">
      <span class="page-info" id="pageInfo">Slide 1 of 31</span>
      <div class="slide-select-wrapper">
        <select class="slide-select" id="slideSelect"></select>
      </div>
    </div>
  </header>

  <main class="content">
    <div id="timerWidget" class="timer-widget hidden">
      <div id="timerDisplay" class="timer-display">01:00</div>
      <div class="timer-controls">
        <button id="timerStart" class="timer-btn">Start</button>
        <button id="timerPause" class="timer-btn">Pause</button>
        <button id="timerReset" class="timer-btn">Reset</button>
      </div>
      <div class="timer-inputs">
        <label>Min: <input id="timerMin" type="number" min="0" max="999" value="1"></label>
        <label>Sec: <input id="timerSec" type="number" min="0" max="59" value="0"></label>
      </div>
    </div>

    <div id="slideMount" style="width:100%; display:flex; flex-direction:column; align-items:center; gap:18px;"></div>

    <canvas id="drawCanvas"></canvas>
  </main>

  <footer class="toolbar">
    <div class="toolbar-left">
      <button id="fullscreenBtn" class="tool-button square-active">‚§¢</button>
      <button id="prevBtn" class="tool-button disabled">‚Üê</button>
      <button id="nextBtn" class="tool-button">‚Üí</button>

      <button id="blackPenBtn" class="pen-circle" title="Black Pen">‚úèÔ∏è</button>
      <button id="yellowPenBtn" class="pen-circle" title="Yellow Pen">‚úèÔ∏è</button>
      <button id="greenPenBtn" class="pen-circle" title="Green Pen">‚úèÔ∏è</button>
      <button id="redPenBtn" class="pen-circle" title="Red Pen">‚úèÔ∏è</button>
      <button id="highlighterBtn" class="pen-circle" title="Yellow Highlighter">üñç</button>
      <button id="eraserBtn" class="pen-circle" title="Eraser">‚ö™</button>

      <button id="penSizeBtn" class="pill-button pill-blue">Pen size: Medium ‚ñæ</button>
      <button id="eraserSizeBtn" class="pill-button pill-blue">Eraser size: Medium ‚ñæ</button>
      <button id="clearBtn" class="pill-button pill-red">Clear</button>
    </div>

    <div class="toolbar-spacer"></div>

    <div class="toolbar-right">
    </div>
  </footer>

  <script>
    /* ============================================================
      CONFIG
    ============================================================ */
    const CONFIG = {
      useStructuredSteps: true,
      fallbackStringParser: false
    };

    /* ============================================================
      DOM HOOKS
    ============================================================ */
    const slideMount = document.getElementById('slideMount');
    const slideSelect = document.getElementById('slideSelect');
    const pageInfo = document.getElementById('pageInfo');

    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');

    const timerWidget = document.getElementById('timerWidget');
    const timerDisplay = document.getElementById('timerDisplay');
    const timerStartBtn = document.getElementById('timerStart');
    const timerPauseBtn = document.getElementById('timerPause');
    const timerResetBtn = document.getElementById('timerReset');
    const timerMinInput = document.getElementById('timerMin');
    const timerSecInput = document.getElementById('timerSec');

    /* ============================================================
      WORKED EXAMPLE RENDERER
    ============================================================ */
    function renderWorkedExample(steps, isCompound = false) {
      // Determine if this is a compound inequality (5 columns) or regular (3 columns)
      const gridCols = isCompound ? 'auto auto auto auto auto' : 'auto auto auto';
      let html = `<div class="worked-example" style="grid-template-columns: ${gridCols};">`;
      
      steps.forEach(step => {
        if (step.type === 'compound-step') {
          // 5-column layout: val1 sign1 val2 sign2 val3
          html += `<div class="lhs">${step.val1}</div>`;
          html += `<div class="sign">${step.sign1}</div>`;
          html += `<div class="lhs">${step.val2}</div>`;
          html += `<div class="sign">${step.sign2}</div>`;
          html += `<div class="rhs">${step.val3}</div>`;
        } else if (step.type === 'compound-operation') {
          // 5-column layout for operations: op1 empty op2 empty op3
          html += `<div class="lhs operation">${step.op1 || ''}</div>`;
          html += `<div class="sign operation"></div>`;
          html += `<div class="lhs operation">${step.op2 || ''}</div>`;
          html += `<div class="sign operation"></div>`;
          html += `<div class="rhs operation">${step.op3 || ''}</div>`;
        } else if (step.type === 'step') {
          html += `<div class="lhs">${step.lhs}</div>`;
          html += `<div class="sign">${step.sign}</div>`;
          html += `<div class="rhs">${step.rhs}</div>`;
        } else if (step.type === 'operation') {
          html += `<div class="lhs operation">${step.lhs || ''}</div>`;
          html += `<div class="sign operation"></div>`;
          html += `<div class="rhs operation">${step.rhs || ''}</div>`;
        } else if (step.type === 'fraction') {
          const denColor = step.redDen ? '' : 'black';
          const lineColor = step.redDen ? '' : 'black';
          const lhsFrac = step.lhsNum ? `
            <div class="fraction-display">
              <div class="numerator">${step.lhsNum}</div>
              <div class="fraction-line ${lineColor}"></div>
              <div class="denominator ${denColor}">${step.lhsDen}</div>
            </div>
          ` : '';
          const rhsFrac = step.rhsNum ? `
            <div class="fraction-display">
              <div class="numerator">${step.rhsNum}</div>
              <div class="fraction-line ${lineColor}"></div>
              <div class="denominator ${denColor}">${step.rhsDen}</div>
            </div>
          ` : '';
          html += `<div class="lhs">${lhsFrac}</div>`;
          html += `<div class="sign">${step.sign}</div>`;
          html += `<div class="rhs">${rhsFrac}</div>`;
        } else if (step.type === 'multiply') {
          html += `<div class="lhs"><span class="bracket-notation">${step.multiplier} (</span></div>`;
          html += `<div class="sign"></div>`;
          html += `<div class="rhs"><span class="bracket-notation">) ${step.multiplier}</span></div>`;
        } else if (step.type === 'multiply-fraction') {
          const lhsFrac = `
            <span class="red-multiplier">${step.multiplier}</span> <span class="red-dot">¬∑</span> <span class="red-bracket">(</span>
            <div class="fraction-display" style="display: inline-flex;">
              <div class="numerator">${step.lhsNum}</div>
              <div class="fraction-line" style="border-color: #000;"></div>
              <div class="denominator" style="color: #000;">${step.lhsDen}</div>
            </div>
            <span class="red-bracket">)</span>
          `;
          const rhsFrac = step.rhsDen === '1' ? 
            `<span class="red-bracket">(</span>${step.rhsNum}<span class="red-bracket">)</span> <span class="red-dot">¬∑</span> <span class="red-multiplier">${step.multiplier}</span>` :
            `<span class="red-bracket">(</span>
            <div class="fraction-display" style="display: inline-flex;">
              <div class="numerator">${step.rhsNum}</div>
              <div class="fraction-line" style="border-color: #000;"></div>
              <div class="denominator" style="color: #000;">${step.rhsDen}</div>
            </div>
            <span class="red-bracket">)</span> <span class="red-dot">¬∑</span> <span class="red-multiplier">${step.multiplier}</span>`;
          html += `<div class="lhs">${lhsFrac}</div>`;
          html += `<div class="sign">${step.sign}</div>`;
          html += `<div class="rhs">${rhsFrac}</div>`;
        }
      });
      
      html += '</div>';
      return html;
    }

    /* ============================================================
      NUMBER LINE RENDERER
    ============================================================ */
    function renderNumberLine(point, isOpen, direction) {
      const positions = {
        '-3': '15%',
        '-2': '25%',
        '-1': '35%',
        '0': '45%',
        '1': '55%',
        '2': '65%',
        '3': '75%'
      };
      
      const pointPos = positions[String(point)] || '45%';
      const pointType = isOpen ? 'open' : 'closed';
      const shadeLeft = direction === 'right' ? pointPos : '10%';
      const shadeRight = direction === 'right' ? '90%' : pointPos;
      
      return `
        <div class="number-line-container">
          <div class="number-line">
            <div class="number-line-axis"></div>
            <div class="number-line-arrow"></div>
            <div class="number-line-shade" style="left: ${shadeLeft}; right: calc(100% - ${shadeRight});"></div>
            ${Object.entries(positions).map(([num, pos]) => `
              <div class="number-line-label" style="left: ${pos};">${num}</div>
              ${num === String(point) ? `<div class="number-line-point ${pointType}" style="left: ${pos};"></div>` : ''}
            `).join('')}
          </div>
        </div>
      `;
    }

    /* ============================================================
      SLIDE TYPE LAYOUT HELPERS
    ============================================================ */
    function renderRowQuestions(items, opts = { forceCount: null }) {
      const rows = [...items];

      if (typeof opts.forceCount === "number") {
        while (rows.length < opts.forceCount) rows.push({ label: "", mainHtml: "", subs: [], placeholder: true });
        if (rows.length > opts.forceCount) rows.length = opts.forceCount;
      }

      return `
        <section class="questions-rows">
          ${rows.map(r => `
            <div class="q-row ${r.placeholder ? "placeholder" : ""}">
              <span class="q-label">${r.label || ""}</span>
              <div class="q-content">
                <div class="q-main"><span class="math">${r.mainHtml || ""}</span></div>
                ${(r.subs || []).map(s => `
                  <div class="q-sub"><span class="math" style="font-size:34px;">${s}</span></div>
                `).join("")}
              </div>
            </div>
          `).join("")}
        </section>
      `;
    }

    function renderMiniWhiteboard(items) {
      const first2 = items.slice(0, 2);
      return `
        <section class="questions-grid">
          ${first2.map(r => `
            <div class="q-block">
              <span class="q-label">${r.label}</span>
              <span class="math">${r.exprHtml}</span>
            </div>
          `).join("")}
        </section>
      `;
    }

    function renderCoreKnowledge(title, bulletPoints, question, content) {
      return `
        <section class="core-knowledge-container">
          <div class="core-left">
            <h1>${title}</h1>
            <ul class="bullets">
              ${bulletPoints.map(bullet => `<li>${bullet}</li>`).join('')}
            </ul>
          </div>
          
          <div class="question-box">
            <h2>${question}</h2>
            <div class="question-content">
              ${content}
            </div>
          </div>
        </section>
      `;
    }

    function renderTwoColumnExamples(exampleA, exampleB) {
      return `
        <div class="teacher-examples-container">
          <div class="teacher-example-col">
            <h2>${exampleA.title}</h2>
            ${exampleA.content}
          </div>
          <div class="teacher-example-col">
            <h2>${exampleB.title}</h2>
            ${exampleB.content}
          </div>
        </div>
      `;
    }

    /* ============================================================
      SLIDE DECK DATA
    ============================================================ */
    const slides = [
      // Slide 1
      {
        timer: null,
        render: () => renderCoreKnowledge(
          'Core Knowledge: Representing Inequalities',
          [
            'Inequalities describe a range of possible values for a variable rather than a single fixed value.',
            'Symbols: \\(>\\) (Greater than), \\(<\\) (Less than), \\(\\ge\\) (Greater than or equal to), \\(\\le\\) (Less than or equal to).',
            'Number Lines: Use an open circle (‚óã) for strict inequalities (\\(<\\) or \\(>\\)). Use a closed circle (‚óè) for inclusive inequalities (\\(\\le\\) or \\(\\ge\\)).'
          ],
          'Worked Example',
          `Represent \\(x > -2\\) on a number line.${renderNumberLine(-2, true, 'right')}`
        )
      },

      // Slide 2
      {
        timer: null,
        render: () => `
          <section class="card example-card">
            <h1>Examples</h1>
            <p>Represent the following on a number line.</p>
          </section>

          ${renderRowQuestions(
            [
              { label: "a)", mainHtml: `\\(x \\le 3\\)` },
              { label: "", mainHtml: "", placeholder: true },
              { label: "b)", mainHtml: `\\(x > -1\\)` },
              { label: "", mainHtml: "", placeholder: true }
            ],
            { forceCount: 4 }
          )}
        `
      },

      // Slide 3 & 4: Mini Whiteboards (split 4 questions into 2 slides)
      {
        timer: { min: 1, sec: 0 },
        render: () => `
          <section class="card example-card">
            <h1>Mini Whiteboards</h1>
            <p><strong>On your whiteboards, represent the following on a number line.</strong></p>
          </section>

          ${renderMiniWhiteboard([
            { label: "1.", exprHtml: `\\(x < 5\\)` },
            { label: "2.", exprHtml: `\\(x \\ge -2\\)` }
          ])}
        `
      },
      {
        timer: { min: 1, sec: 0 },
        render: () => `
          <section class="card example-card">
            <h1>Mini Whiteboards</h1>
            <p><strong>On your whiteboards, represent the following on a number line.</strong></p>
          </section>

          ${renderMiniWhiteboard([
            { label: "3.", exprHtml: `\\(x \\le 0\\)` },
            { label: "4.", exprHtml: `\\(x > 4\\)` }
          ])}
        `
      },

      // Slide 5
      {
        timer: null,
        render: () => renderCoreKnowledge(
          'Core Knowledge: One-Step Inequalities',
          [
            'To solve an inequality, isolate the variable by performing the inverse operation on both sides.',
            'The solution represents the range of values that make the inequality true.'
          ],
          'Worked Example',
          renderWorkedExample([
            { type: 'step', lhs: '\\(x + 4\\)', sign: '\\(>\\)', rhs: '9' },
            { type: 'operation', lhs: '-4', rhs: '-4' },
            { type: 'step', lhs: '\\(x\\)', sign: '\\(>\\)', rhs: '5' }
          ])
        )
      },

      // Slide 6
      {
        timer: null,
        render: () => `
          <section class="card example-card">
            <h1>Examples</h1>
            <p>Solve the following inequalities.</p>
          </section>

          ${renderTwoColumnExamples(
            {
              title: 'Example a)',
              content: renderWorkedExample([
                { type: 'step', lhs: '\\(x - 3\\)', sign: '\\(<\\)', rhs: '2' }
              ])
            },
            {
              title: 'Example b)',
              content: renderWorkedExample([
                { type: 'step', lhs: '\\(5x\\)', sign: '\\(\\ge\\)', rhs: '15' }
              ])
            }
          )}
        `
      },

      // Slide 7 & 8
      {
        timer: { min: 1, sec: 0 },
        render: () => `
          <section class="card example-card">
            <h1>Mini Whiteboards</h1>
            <p><strong>On your whiteboards, solve the following.</strong></p>
          </section>

          ${renderMiniWhiteboard([
            { label: "1.", exprHtml: `\\(2x \\le 14\\)` },
            { label: "2.", exprHtml: `\\(8x < 16\\)` }
          ])}
        `
      },
      {
        timer: { min: 1, sec: 0 },
        render: () => `
          <section class="card example-card">
            <h1>Mini Whiteboards</h1>
            <p><strong>On your whiteboards, solve the following.</strong></p>
          </section>

          ${renderMiniWhiteboard([
            { label: "3.", exprHtml: `\\(\\frac{x}{3} > 4\\)` },
            { label: "4.", exprHtml: `\\(x + 6 \\ge 4\\)` }
          ])}
        `
      },

      // Slide 9
      {
        timer: null,
        render: () => renderCoreKnowledge(
          'Core Knowledge: Two-Step Inequalities',
          [
            'Use inverse operations in reverse BIDMAS order.',
            'First, add or subtract the constant term.',
            'Second, multiply or divide to solve for \\(x\\).'
          ],
          'Worked Example',
          renderWorkedExample([
            { type: 'step', lhs: '\\(2x + 1\\)', sign: '\\(\\le\\)', rhs: '9' },
            { type: 'operation', lhs: '-1', rhs: '-1' },
            { type: 'step', lhs: '\\(2x\\)', sign: '\\(\\le\\)', rhs: '8' },
            { type: 'fraction', lhsNum: '\\(2x\\)', lhsDen: '2', sign: '\\(\\le\\)', rhsNum: '8', rhsDen: '2' },
            { type: 'step', lhs: '\\(x\\)', sign: '\\(\\le\\)', rhs: '4' }
          ])
        )
      },

      // Slide 10
      {
        timer: null,
        render: () => `
          <section class="card example-card">
            <h1>Examples</h1>
            <p>Solve the following inequalities.</p>
          </section>

          ${renderTwoColumnExamples(
            {
              title: 'Example a)',
              content: renderWorkedExample([
                { type: 'step', lhs: '\\(3x - 5\\)', sign: '\\(>\\)', rhs: '16' }
              ])
            },
            {
              title: 'Example b)',
              content: renderWorkedExample([
                { type: 'step', lhs: '\\(4x + 8\\)', sign: '\\(<\\)', rhs: '32' }
              ])
            }
          )}
        `
      },

      // Slide 11 & 12
      {
        timer: { min: 1, sec: 0 },
        render: () => `
          <section class="card example-card">
            <h1>Mini Whiteboards</h1>
            <p><strong>On your whiteboards, solve the following.</strong></p>
          </section>

          ${renderMiniWhiteboard([
            { label: "1.", exprHtml: `\\(5x - 2 \\ge 68\\)` },
            { label: "2.", exprHtml: `\\(4x + 7 < 11\\)` }
          ])}
        `
      },
      {
        timer: { min: 1, sec: 0 },
        render: () => `
          <section class="card example-card">
            <h1>Mini Whiteboards</h1>
            <p><strong>On your whiteboards, solve the following.</strong></p>
          </section>

          ${renderMiniWhiteboard([
            { label: "3.", exprHtml: `\\(3x - 2 \\ge 10\\)` },
            { label: "4.", exprHtml: `\\(2x + 5 \\le 17\\)` }
          ])}
        `
      },

      // Slide 13
      {
        timer: null,
        render: () => renderCoreKnowledge(
          'Core Knowledge: Fractional Inequalities',
          [
            'If the entire expression is over a denominator, multiply both sides by that denominator first.',
            'If only the variable is part of a fraction, isolate the fractional term before multiplying.'
          ],
          'Worked Example',
          renderWorkedExample([
            { type: 'multiply-fraction', lhsNum: '\\(x+18\\)', lhsDen: '4', sign: '\\(\\le\\)', rhsNum: '5', rhsDen: '1', multiplier: '4' },
            { type: 'step', lhs: '\\(x + 18\\)', sign: '\\(\\le\\)', rhs: '20' },
            { type: 'operation', lhs: '-18', rhs: '-18' },
            { type: 'step', lhs: '\\(x\\)', sign: '\\(\\le\\)', rhs: '2' }
          ])
        )
      },

      // Slide 14
      {
        timer: null,
        render: () => `
          <section class="card example-card">
            <h1>Examples</h1>
            <p>Solve the following inequalities.</p>
          </section>

          ${renderTwoColumnExamples(
            {
              title: 'Example a)',
              content: renderWorkedExample([
                { type: 'step', lhs: '\\(\\frac{x}{2} + 1\\)', sign: '\\(\\le\\)', rhs: '5' }
              ])
            },
            {
              title: 'Example b)',
              content: renderWorkedExample([
                { type: 'step', lhs: '\\(\\frac{x+3}{2}\\)', sign: '\\(\\ge\\)', rhs: '5' }
              ])
            }
          )}
        `
      },

      // Slide 15 & 16
      {
        timer: { min: 1, sec: 0 },
        render: () => `
          <section class="card example-card">
            <h1>Mini Whiteboards</h1>
            <p><strong>On your whiteboards, solve the following.</strong></p>
          </section>

          ${renderMiniWhiteboard([
            { label: "1.", exprHtml: `\\(\\frac{x}{9} - 6 > 4\\)` },
            { label: "2.", exprHtml: `\\(\\frac{4x-5}{10} > 2\\)` }
          ])}
        `
      },
      {
        timer: { min: 1, sec: 0 },
        render: () => `
          <section class="card example-card">
            <h1>Mini Whiteboards</h1>
            <p><strong>On your whiteboards, solve the following.</strong></p>
          </section>

          ${renderMiniWhiteboard([
            { label: "3.", exprHtml: `\\(\\frac{x}{2} - 3 > 0\\)` },
            { label: "4.", exprHtml: `\\(\\frac{x+4}{3} \\le 6\\)` }
          ])}
        `
      },

      // Slide 17
      {
        timer: null,
        render: () => renderCoreKnowledge(
          'Core Knowledge: Single Brackets',
          [
            'Expand the brackets first by multiplying the term outside by every term inside.',
            'Solve the resulting inequality using standard two-step methods.'
          ],
          'Worked Example',
          renderWorkedExample([
            { type: 'step', lhs: '\\(5(x - 3)\\)', sign: '\\(\\ge\\)', rhs: '40' },
            { type: 'step', lhs: '\\(5x - 15\\)', sign: '\\(\\ge\\)', rhs: '40' },
            { type: 'operation', lhs: '+15', rhs: '+15' },
            { type: 'step', lhs: '\\(5x\\)', sign: '\\(\\ge\\)', rhs: '55' },
            { type: 'fraction', lhsNum: '\\(5x\\)', lhsDen: '5', sign: '\\(\\ge\\)', rhsNum: '55', rhsDen: '5' },
            { type: 'step', lhs: '\\(x\\)', sign: '\\(\\ge\\)', rhs: '11' }
          ])
        )
      },

      // Slide 18
      {
        timer: null,
        render: () => `
          <section class="card example-card">
            <h1>Examples</h1>
            <p>Solve the following inequalities.</p>
          </section>

          ${renderTwoColumnExamples(
            {
              title: 'Example a)',
              content: renderWorkedExample([
                { type: 'step', lhs: '\\(6(x + 2)\\)', sign: '\\(<\\)', rhs: '42' }
              ])
            },
            {
              title: 'Example b)',
              content: renderWorkedExample([
                { type: 'step', lhs: '\\(2(5x + 1)\\)', sign: '\\(\\le\\)', rhs: '36' }
              ])
            }
          )}
        `
      },

      // Slide 19 & 20
      {
        timer: { min: 1, sec: 0 },
        render: () => `
          <section class="card example-card">
            <h1>Mini Whiteboards</h1>
            <p><strong>On your whiteboards, solve the following.</strong></p>
          </section>

          ${renderMiniWhiteboard([
            { label: "1.", exprHtml: `\\(4(x - 2) < 18\\)` },
            { label: "2.", exprHtml: `\\(2(2x - 9) \\ge 22\\)` }
          ])}
        `
      },
      {
        timer: { min: 1, sec: 0 },
        render: () => `
          <section class="card example-card">
            <h1>Mini Whiteboards</h1>
            <p><strong>On your whiteboards, solve the following.</strong></p>
          </section>

          ${renderMiniWhiteboard([
            { label: "3.", exprHtml: `\\(3(2x + 7) \\le 9\\)` },
            { label: "4.", exprHtml: `\\(5(x + 1) > 25\\)` }
          ])}
        `
      },

      // Slide 21
      {
        timer: null,
        render: () => renderCoreKnowledge(
          'Core Knowledge: Variables on Both Sides',
          [
            'Collect all terms involving \\(x\\) on one side (the side with the higher coefficient).',
            'Collect all constant terms on the opposite side.'
          ],
          'Worked Example',
          renderWorkedExample([
            { type: 'step', lhs: '\\(4x + 3\\)', sign: '\\(>\\)', rhs: '\\(2x + 11\\)' },
            { type: 'operation', lhs: '-2x', rhs: '-2x' },
            { type: 'step', lhs: '\\(2x + 3\\)', sign: '\\(>\\)', rhs: '11' },
            { type: 'operation', lhs: '-3', rhs: '-3' },
            { type: 'step', lhs: '\\(2x\\)', sign: '\\(>\\)', rhs: '8' },
            { type: 'fraction', lhsNum: '\\(2x\\)', lhsDen: '2', sign: '\\(>\\)', rhsNum: '8', rhsDen: '2' },
            { type: 'step', lhs: '\\(x\\)', sign: '\\(>\\)', rhs: '4' }
          ])
        )
      },

      // Slide 22
      {
        timer: null,
        render: () => `
          <section class="card example-card">
            <h1>Examples</h1>
            <p>Solve the following inequalities.</p>
          </section>

          ${renderTwoColumnExamples(
            {
              title: 'Example a)',
              content: renderWorkedExample([
                { type: 'step', lhs: '\\(13x - 12\\)', sign: '\\(<\\)', rhs: '\\(3x + 13\\)' }
              ])
            },
            {
              title: 'Example b)',
              content: renderWorkedExample([
                { type: 'step', lhs: '\\(7x - 5\\)', sign: '\\(\\ge\\)', rhs: '\\(3x + 11\\)' }
              ])
            }
          )}
        `
      },

      // Slide 23 & 24
      {
        timer: { min: 1, sec: 0 },
        render: () => `
          <section class="card example-card">
            <h1>Mini Whiteboards</h1>
            <p><strong>On your whiteboards, solve the following.</strong></p>
          </section>

          ${renderMiniWhiteboard([
            { label: "1.", exprHtml: `\\(x + 1 \\ge 3x - 18\\)` },
            { label: "2.", exprHtml: `\\(5x + 2 < 2x + 14\\)` }
          ])}
        `
      },
      {
        timer: { min: 1, sec: 0 },
        render: () => `
          <section class="card example-card">
            <h1>Mini Whiteboards</h1>
            <p><strong>On your whiteboards, solve the following.</strong></p>
          </section>

          ${renderMiniWhiteboard([
            { label: "3.", exprHtml: `\\(6x - 4 \\ge 4x + 10\\)` },
            { label: "4.", exprHtml: `\\(8x - 1 \\le 3x + 24\\)` }
          ])}
        `
      },

      // Slide 25: Compound Inequalities Concept (FIXED)
      {
        timer: null,
        render: () => renderCoreKnowledge(
          'Core Knowledge: Compound Inequalities',
          [
            'A compound inequality involves two inequality symbols with the variable in the middle.',
            'The solution must satisfy both inequalities simultaneously.',
            'Treat each part separately, performing the same operations to all three parts.'
          ],
          'Worked Example: Find the range of values for \\(x\\)',
          renderWorkedExample([
            { type: 'compound-step', val1: '6', sign1: '\\( < \\)', val2: '\\(x + 3\\)', sign2: '\\( < \\)', val3: '10' },
            { type: 'compound-operation', op1: '-3', op2: '-3', op3: '-3' },
            { type: 'compound-step', val1: '3', sign1: '\\( < \\)', val2: '\\(x\\)', sign2: '\\( < \\)', val3: '7' }
          ], true)
        )
      },

      // Slide 26: Worked Example 1
      {
        timer: null,
        render: () => `
          <section class="card example-card">
            <h1>Examples</h1>
            <p>Solve the following compound inequalities.</p>
          </section>

          ${renderTwoColumnExamples(
            {
              title: 'Example a)',
              content: renderWorkedExample([
                { type: 'step', lhs: '4', sign: '\\( \\le \\)', rhs: '\\(2x ‚â§ 7\\)' }
              ])
            },
            {
              title: 'Example b)',
              content: renderWorkedExample([
                { type: 'step', lhs: '1', sign: '\\( \\le \\)', rhs: '\\(3x < 9\\)' }
              ])
            }
          )}
        `
      },

      // Slide 27: Worked Example 2 (FIXED)
      {
        timer: null,
        render: () => renderCoreKnowledge(
          'Core Knowledge: Compound Inequalities with Operations',
          [
            'When solving compound inequalities with operations on the variable, apply inverse operations to all three parts.',
            'Work systematically: first deal with addition/subtraction, then multiplication/division.',
            'Keep the inequality symbols pointing in their original direction throughout.'
          ],
          'Worked Example: Find the range of values for \\(x\\)',
          renderWorkedExample([
            { type: 'compound-step', val1: '9', sign1: '\\( \\le \\)', val2: '\\(2x + 3\\)', sign2: '\\( \\le \\)', val3: '25' },
            { type: 'compound-operation', op1: '-3', op2: '-3', op3: '-3' },
            { type: 'compound-step', val1: '6', sign1: '\\( \\le \\)', val2: '\\(2x\\)', sign2: '\\( \\le \\)', val3: '22' },
            { type: 'compound-step', val1: '\\(\\frac{6}{\\color{red}{2}}\\)', sign1: '\\( \\le \\)', val2: '\\(\\frac{2x}{\\color{red}{2}}\\)', sign2: '\\( \\le \\)', val3: '\\(\\frac{22}{\\color{red}{2}}\\)' },
            { type: 'compound-step', val1: '3', sign1: '\\( \\le \\)', val2: '\\(x\\)', sign2: '\\( \\le \\)', val3: '11' }
          ], true)
        )
      },

      // Slide 28: Examples (REGENERATED)
      {
        timer: null,
        render: () => `
          <section class="card example-card">
            <h1>Examples</h1>
            <p>Solve the following compound inequalities.</p>
          </section>

          ${renderTwoColumnExamples(
            {
              title: 'Example a)',
              content: renderWorkedExample([
                { type: 'step', lhs: '4', sign: '\\( < \\)', rhs: '\\(\\frac{x}{5} < 6\\)' }
              ])
            },
            {
              title: 'Example b)',
              content: renderWorkedExample([
                { type: 'step', lhs: '-3', sign: '\\( \\le \\)', rhs: '\\(\\frac{x}{4} - 1 < 0\\)' }
              ])
            }
          )}
        `
      },

      // Slide 29: Mini Whiteboards (REGENERATED)
      {
        timer: { min: 1, sec: 0 },
        render: () => `
          <section class="card example-card">
            <h1>Mini Whiteboards</h1>
            <p><strong>On your whiteboards, solve the following compound inequalities.</strong></p>
          </section>

        ${renderMiniWhiteboard([
        { label: "1.", exprHtml: `<span style="font-size: 42px;">2 < 3x + 1 ‚â§ 10</span>` },
        { label: "2.", exprHtml: `<span style="font-size: 42px;">5 ‚â§ 4x - 3 < 17</span>` }
        ])}
        `
      },

      // Slide 30: Mini Whiteboards Continued (NEW)
      {
        timer: { min: 1, sec: 0 },
        render: () => `
          <section class="card example-card">
            <h1>Mini Whiteboards</h1>
            <p><strong>On your whiteboards, solve the following compound inequalities.</strong></p>
          </section>

        ${renderMiniWhiteboard([
        { label: "3.", exprHtml: `<span style="font-size: 42px;">1 ‚â§ 2x + 5 < 15</span>` },
        { label: "4.", exprHtml: `<span style="font-size: 42px;">-3 < 5x - 8 ‚â§ 12</span>` }
        ])}
        `
      },

      // Slide 31: FINAL REVIEW (FIXED - Two methods side by side)
      {
        timer: null,
        render: () => `
          <section class="review-slide">
            <div class="review-title">üìù Core Knowledge Review - Write in your books:</div>

            <div class="review-box">
              <strong>Solving inequalities</strong><br>
              Use inverse operations to isolate the variable, just as you would with equations.
              <div class="review-example">
                ${renderWorkedExample([
                  { type: 'step', lhs: '\\(2x + 1\\)', sign: '\\(\\le\\)', rhs: '9' },
                  { type: 'operation', lhs: '-1', rhs: '-1' },
                  { type: 'step', lhs: '\\(2x\\)', sign: '\\(\\le\\)', rhs: '8' },
                  { type: 'fraction', lhsNum: '\\(2x\\)', lhsDen: '2', sign: '\\(\\le\\)', rhsNum: '8', rhsDen: '2', redDen: true },
                  { type: 'step', lhs: '\\(x\\)', sign: '\\(\\le\\)', rhs: '4' }
                ])}
              </div>
            </div>

            <div class="review-box">
              <strong>Solving inequalities with brackets</strong><br>
              Two methods: expand first, or divide by the coefficient of the bracket first.
              <div class="two-methods-container">
                <div class="method-box">
                  <div class="method-title">Method A: Expand first</div>
                  <div class="review-example">
                    ${renderWorkedExample([
                      { type: 'step', lhs: '\\(3(2x + 7)\\)', sign: '\\(\\le\\)', rhs: '9' },
                      { type: 'step', lhs: '\\(6x + 21\\)', sign: '\\(\\le\\)', rhs: '9' },
                      { type: 'operation', lhs: '-21', rhs: '-21' },
                      { type: 'step', lhs: '\\(6x\\)', sign: '\\(\\le\\)', rhs: '-12' },
                      { type: 'fraction', lhsNum: '\\(6x\\)', lhsDen: '6', sign: '\\(\\le\\)', rhsNum: '-12', rhsDen: '6', redDen: true },
                      { type: 'step', lhs: '\\(x\\)', sign: '\\(\\le\\)', rhs: '-2' }
                    ])}
                  </div>
                </div>
                <div class="method-box">
                  <div class="method-title">Method B: Divide first</div>
                  <div class="review-example">
                    ${renderWorkedExample([
                      { type: 'step', lhs: '\\(3(2x + 7)\\)', sign: '\\(\\le\\)', rhs: '9' },
                      { type: 'fraction', lhsNum: '\\(3(2x + 7)\\)', lhsDen: '3', sign: '\\(\\le\\)', rhsNum: '9', rhsDen: '3', redDen: true },
                      { type: 'step', lhs: '\\(2x + 7\\)', sign: '\\(\\le\\)', rhs: '3' },
                      { type: 'operation', lhs: '-7', rhs: '-7' },
                      { type: 'step', lhs: '\\(2x\\)', sign: '\\(\\le\\)', rhs: '-4' },
                      { type: 'fraction', lhsNum: '\\(2x\\)', lhsDen: '2', sign: '\\(\\le\\)', rhsNum: '-4', rhsDen: '2', redDen: true },
                      { type: 'step', lhs: '\\(x\\)', sign: '\\(\\le\\)', rhs: '-2' }
                    ])}
                  </div>
                </div>
              </div>
            </div>

            <div class="review-box">
              <strong>Solving inequalities with fractions</strong><br>
              Multiply both sides by the denominator to clear the fraction.
              <div class="review-example">
                ${renderWorkedExample([
                  { type: 'multiply-fraction', lhsNum: '\\(x+18\\)', lhsDen: '4', sign: '\\(>\\)', rhsNum: '5', rhsDen: '1', multiplier: '4' },
                  { type: 'step', lhs: '\\(x + 18\\)', sign: '\\(>\\)', rhs: '20' },
                  { type: 'operation', lhs: '-18', rhs: '-18' },
                  { type: 'step', lhs: '\\(x\\)', sign: '\\(>\\)', rhs: '2' }
                ])}
              </div>
            </div>

            <div class="review-box">
              <strong>Variable on both sides</strong><br>
              Collect all \\(x\\) terms on one side, constants on the other.
              <div class="review-example">
                ${renderWorkedExample([
                  { type: 'step', lhs: '\\(4x + 3\\)', sign: '\\(>\\)', rhs: '\\(2x + 11\\)' },
                  { type: 'operation', lhs: '-2x', rhs: '-2x' },
                  { type: 'step', lhs: '\\(2x + 3\\)', sign: '\\(>\\)', rhs: '11' },
                  { type: 'operation', lhs: '-3', rhs: '-3' },
                  { type: 'step', lhs: '\\(2x\\)', sign: '\\(>\\)', rhs: '8' },
                  { type: 'fraction', lhsNum: '\\(2x\\)', lhsDen: '2', sign: '\\(>\\)', rhsNum: '8', rhsDen: '2', redDen: true },
                  { type: 'step', lhs: '\\(x\\)', sign: '\\(>\\)', rhs: '4' }
                ])}
              </div>
            </div>

            <div class="review-box">
              <strong>Two inequalities (compound)</strong><br>
              Apply the same operation to all three parts simultaneously.
              <div class="review-example">
                ${renderWorkedExample([
                  { type: 'compound-step', val1: '2', sign1: '\\( < \\)', val2: '\\(3x + 1\\)', sign2: '\\( \\le \\)', val3: '10' },
                  { type: 'compound-operation', op1: '-1', op2: '-1', op3: '-1' },
                  { type: 'compound-step', val1: '1', sign1: '\\( < \\)', val2: '\\(3x\\)', sign2: '\\( \\le \\)', val3: '9' },
                  { type: 'compound-step', val1: '\\(\\frac{1}{\\color{red}{3}}\\)', sign1: '\\( < \\)', val2: '\\(\\frac{3x}{\\color{red}{3}}\\)', sign2: '\\( \\le \\)', val3: '\\(\\frac{9}{\\color{red}{3}}\\)' },
                  { type: 'compound-step', val1: '\\(\\frac{1}{3}\\)', sign1: '\\( < \\)', val2: '\\(x\\)', sign2: '\\( \\le \\)', val3: '3' }
                ], true)}
              </div>
            </div>

            <div class="apply-task">
              <h2>Independent Apply Task</h2>
              <p>Complete all questions on the worksheet, showing all working clearly.</p>
            </div>
          </section>
        `
      }
    ];

    /* ============================================================
      SLIDE NAVIGATION STATE
    ============================================================ */
    const maxSlide = slides.length - 1;
    let currentSlide = 0;

    function buildDropdown() {
      slideSelect.innerHTML = "";
      slides.forEach((_, i) => {
        const opt = document.createElement("option");
        opt.value = String(i);
        opt.textContent = `Slide ${i + 1}`;
        slideSelect.appendChild(opt);
      });
    }
    buildDropdown();

    function updateNavUI() {
      prevBtn.classList.toggle('disabled', currentSlide === 0);
      nextBtn.classList.toggle('disabled', currentSlide === maxSlide);
      pageInfo.textContent = `Slide ${currentSlide + 1} of ${maxSlide + 1}`;
      slideSelect.value = String(currentSlide);
    }

    function renderSlide() {
      const t = slides[currentSlide].timer;
      if (t) {
        timerWidget.classList.remove('hidden');
        setTimerTo(t.min, t.sec);
      } else {
        timerWidget.classList.add('hidden');
        pauseTimer();
      }

      slideMount.innerHTML = slides[currentSlide].render();
      if (window.MathJax?.typesetPromise) MathJax.typesetPromise();
      updateNavUI();
      resizeCanvas();
      restoreDrawingForSlide(currentSlide);
    }

    function changeSlideTo(target) {
      if (target < 0 || target > maxSlide) return;
      saveCurrentSlideDrawing();
      currentSlide = target;
      renderSlide();
    }

    prevBtn.addEventListener('click', () => changeSlideTo(currentSlide - 1));
    nextBtn.addEventListener('click', () => changeSlideTo(currentSlide + 1));
    slideSelect.addEventListener('change', (e) => changeSlideTo(parseInt(e.target.value, 10) || 0));

    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') { e.preventDefault(); changeSlideTo(currentSlide - 1); }
      if (e.key === 'ArrowRight') { e.preventDefault(); changeSlideTo(currentSlide + 1); }
    });

    /* ============================================================
      DRAWING SYSTEM
    ============================================================ */
    const canvas = document.getElementById('drawCanvas');
    const contentEl = document.querySelector('.content');
    const ctx = canvas.getContext('2d');

    const blackPenBtn = document.getElementById('blackPenBtn');
    const yellowPenBtn = document.getElementById('yellowPenBtn');
    const greenPenBtn = document.getElementById('greenPenBtn');
    const redPenBtn = document.getElementById('redPenBtn');
    const highlighterBtn = document.getElementById('highlighterBtn');
    const eraserBtn = document.getElementById('eraserBtn');

    const penSizeBtn = document.getElementById('penSizeBtn');
    const eraserSizeBtn = document.getElementById('eraserSizeBtn');
    const clearBtn = document.getElementById('clearBtn');

    let drawingEnabled = false;
    let isDrawing = false;
    let currentTool = 'pen';
    let currentColor = '#1a1a1a';

    const slideDrawings = new Array(slides.length).fill(null);

    const penSizes = [
      { label: 'Small', value: 2 },
      { label: 'Medium', value: 4 },
      { label: 'Large', value: 8 }
    ];
    const eraserSizes = [
      { label: 'Small', value: 10 },
      { label: 'Medium', value: 20 },
      { label: 'Large', value: 40 }
    ];
    const highlighterSize = 30;
    
    let penSizeIndex = 1;
    let eraserSizeIndex = 1;

    function currentPenSize() { return penSizes[penSizeIndex].value; }
    function currentEraserSize() { return eraserSizes[eraserSizeIndex].value; }

    function updateSizeLabels() {
      penSizeBtn.textContent = `Pen size: ${penSizes[penSizeIndex].label} ‚ñæ`;
      eraserSizeBtn.textContent = `Eraser size: ${eraserSizes[eraserSizeIndex].label} ‚ñæ`;
    }
    updateSizeLabels();

    function enableDrawing(enable) {
      drawingEnabled = enable;
      canvas.style.pointerEvents = enable ? 'auto' : 'none';
    }

    function setActiveToolButton(btn) {
      [blackPenBtn, yellowPenBtn, greenPenBtn, redPenBtn, highlighterBtn, eraserBtn].forEach(b => b.classList.remove('active'));
      if (btn) btn.classList.add('active');
    }

    blackPenBtn.addEventListener('click', () => {
      currentTool = 'pen';
      currentColor = '#1a1a1a';
      enableDrawing(true);
      setActiveToolButton(blackPenBtn);
    });

    yellowPenBtn.addEventListener('click', () => {
      currentTool = 'pen';
      currentColor = '#f1c40f';
      enableDrawing(true);
      setActiveToolButton(yellowPenBtn);
    });

    greenPenBtn.addEventListener('click', () => {
      currentTool = 'pen';
      currentColor = '#27ae60';
      enableDrawing(true);
      setActiveToolButton(greenPenBtn);
    });

    redPenBtn.addEventListener('click', () => {
      currentTool = 'pen';
      currentColor = '#e74c3c';
      enableDrawing(true);
      setActiveToolButton(redPenBtn);
    });

    highlighterBtn.addEventListener('click', () => {
      currentTool = 'highlighter';
      currentColor = 'rgba(255, 235, 59, 0.4)';
      enableDrawing(true);
      setActiveToolButton(highlighterBtn);
    });

    eraserBtn.addEventListener('click', () => {
      currentTool = 'eraser';
      enableDrawing(true);
      setActiveToolButton(eraserBtn);
    });

    penSizeBtn.addEventListener('click', () => {
      penSizeIndex = (penSizeIndex + 1) % penSizes.length;
      updateSizeLabels();
    });

    eraserSizeBtn.addEventListener('click', () => {
      eraserSizeIndex = (eraserSizeIndex + 1) % eraserSizes.length;
      updateSizeLabels();
    });

    clearBtn.addEventListener('click', () => {
      clearCanvas();
      slideDrawings[currentSlide] = null;
    });

    function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); }

    function saveCurrentSlideDrawing() {
      slideDrawings[currentSlide] = canvas.toDataURL('image/png');
    }

    function restoreDrawingForSlide(index) {
      ctx.globalCompositeOperation = 'source-over';
      clearCanvas();
      const dataUrl = slideDrawings[index];
      if (!dataUrl) return;
      const img = new Image();
      img.onload = () => {
        ctx.globalCompositeOperation = 'source-over';
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      };
      img.src = dataUrl;
    }

    function resizeCanvas() {
      const rect = contentEl.getBoundingClientRect();
      canvas.width = rect.width;
      canvas.height = rect.height;
      restoreDrawingForSlide(currentSlide);
    }
    window.addEventListener('resize', resizeCanvas);

    function startDraw(x, y) {
      if (!drawingEnabled) return;
      isDrawing = true;
      ctx.beginPath();
      ctx.moveTo(x, y);
    }

    function drawLine(x, y) {
      if (!isDrawing) return;
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';

      if (currentTool === 'eraser') {
        ctx.globalCompositeOperation = 'destination-out';
        ctx.lineWidth = currentEraserSize();
      } else if (currentTool === 'highlighter') {
        ctx.globalCompositeOperation = 'source-over';
        ctx.strokeStyle = currentColor;
        ctx.lineWidth = highlighterSize;
      } else {
        ctx.globalCompositeOperation = 'source-over';
        ctx.strokeStyle = currentColor;
        ctx.lineWidth = currentPenSize();
      }
      ctx.lineTo(x, y);
      ctx.stroke();
    }

    function stopDraw() {
      if (!isDrawing) return;
      isDrawing = false;
      ctx.closePath();
      saveCurrentSlideDrawing();
    }

    canvas.addEventListener('mousedown', (e) => {
      const rect = canvas.getBoundingClientRect();
      startDraw(e.clientX - rect.left, e.clientY - rect.top);
    });
    canvas.addEventListener('mousemove', (e) => {
      const rect = canvas.getBoundingClientRect();
      drawLine(e.clientX - rect.left, e.clientY - rect.top);
    });
    canvas.addEventListener('mouseup', stopDraw);
    canvas.addEventListener('mouseleave', stopDraw);

    canvas.addEventListener('touchstart', (e) => {
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      startDraw(touch.clientX - rect.left, touch.clientY - rect.top);
      e.preventDefault();
    }, { passive: false });

    canvas.addEventListener('touchmove', (e) => {
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      drawLine(touch.clientX - rect.left, touch.clientY - rect.top);
      e.preventDefault();
    }, { passive: false });

    canvas.addEventListener('touchend', stopDraw);
    canvas.addEventListener('touchcancel', stopDraw);

    /* ============================================================
      TIMER SYSTEM
    ============================================================ */
    let timerInterval = null;
    let timerRemainingSeconds = 60;
    let timerSetSeconds = 60;

    function clamp(num, min, max) { return Math.min(max, Math.max(min, num)); }
    function pad2(n) { return String(n).padStart(2, '0'); }

    function renderTimer() {
      const m = Math.floor(timerRemainingSeconds / 60);
      const s = timerRemainingSeconds % 60;
      timerDisplay.textContent = `${pad2(m)}:${pad2(s)}`;
    }

    function readInputsAsSeconds() {
      const min = clamp(parseInt(timerMinInput.value, 10) || 0, 0, 999);
      const sec = clamp(parseInt(timerSecInput.value, 10) || 0, 0, 59);
      timerMinInput.value = String(min);
      timerSecInput.value = String(sec);
      return (min * 60) + sec;
    }

    function stopTimerInterval() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }

    function startTimer() {
      const inputSeconds = readInputsAsSeconds();
      const shouldUseInputs =
        timerRemainingSeconds === 0 ||
        timerRemainingSeconds === timerSetSeconds;

      if (shouldUseInputs) {
        timerSetSeconds = inputSeconds || 0;
        timerRemainingSeconds = timerSetSeconds;
      }

      stopTimerInterval();
      timerInterval = setInterval(() => {
        if (timerRemainingSeconds > 0) {
          timerRemainingSeconds -= 1;
          renderTimer();
        } else {
          stopTimerInterval();
        }
      }, 1000);

      renderTimer();
    }

    function pauseTimer() { stopTimerInterval(); }

    function resetTimer() {
      stopTimerInterval();
      timerRemainingSeconds = timerSetSeconds;
      timerMinInput.value = String(Math.floor(timerSetSeconds / 60));
      timerSecInput.value = String(timerSetSeconds % 60);
      renderTimer();
    }

    function setTimerTo(min, sec) {
      stopTimerInterval();
      min = clamp(parseInt(min, 10) || 0, 0, 999);
      sec = clamp(parseInt(sec, 10) || 0, 0, 59);

      timerMinInput.value = String(min);
      timerSecInput.value = String(sec);

      timerSetSeconds = (min * 60) + sec;
      timerRemainingSeconds = timerSetSeconds;
      renderTimer();
    }

    timerStartBtn.addEventListener('click', startTimer);
    timerPauseBtn.addEventListener('click', pauseTimer);
    timerResetBtn.addEventListener('click', resetTimer);

    function onInputsChanged() {
      const secs = readInputsAsSeconds();
      timerSetSeconds = secs;
      if (!timerInterval) {
        timerRemainingSeconds = timerSetSeconds;
        renderTimer();
      }
    }
    timerMinInput.addEventListener('input', onInputsChanged);
    timerSecInput.addEventListener('change', onInputsChanged);
    timerSecInput.addEventListener('input', onInputsChanged);
    timerMinInput.addEventListener('change', onInputsChanged);

    renderTimer();

    /* ============================================================
      DRAGGABLE TIMER
    ============================================================ */
    const TIMER_POS_KEY = 'timerWidgetPosition_v3';

    function loadTimerPosition() {
      try {
        const raw = localStorage.getItem(TIMER_POS_KEY);
        if (!raw) return;
        const pos = JSON.parse(raw);
        if (typeof pos?.left !== 'number' || typeof pos?.top !== 'number') return;
        timerWidget.style.left = `${pos.left}px`;
        timerWidget.style.top = `${pos.top}px`;
      } catch {}
    }

    function saveTimerPosition(left, top) {
      localStorage.setItem(TIMER_POS_KEY, JSON.stringify({ left, top }));
    }

    function makeDraggableAbsolute(el, onSave) {
      let dragging = false;
      let offsetX = 0;
      let offsetY = 0;

      el.addEventListener('mousedown', (e) => {
        const tag = e.target.tagName.toLowerCase();
        if (tag === 'input' || tag === 'button') return;

        dragging = true;
        const rect = el.getBoundingClientRect();
        offsetX = e.clientX - rect.left;
        offsetY = e.clientY - rect.top;
        e.preventDefault();
      });

      window.addEventListener('mousemove', (e) => {
        if (!dragging) return;
        const parentRect = contentEl.getBoundingClientRect();

        let left = e.clientX - parentRect.left - offsetX;
        let top = e.clientY - parentRect.top - offsetY;

        left = clamp(left, 0, parentRect.width - el.offsetWidth);
        top = clamp(top, 0, parentRect.height - el.offsetHeight);

        el.style.left = `${left}px`;
        el.style.top = `${top}px`;
      });

      window.addEventListener('mouseup', () => {
        if (!dragging) return;
        dragging = false;
        const left = parseFloat(el.style.left) || 0;
        const top = parseFloat(el.style.top) || 0;
        if (onSave) onSave(left, top);
      });
    }

    loadTimerPosition();
    makeDraggableAbsolute(timerWidget, saveTimerPosition);

    /* ============================================================
      FULLSCREEN
    ============================================================ */
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    fullscreenBtn.addEventListener('click', () => {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    });

    /* ============================================================
      INIT
    ============================================================ */
    renderSlide();
  </script>
</body>
</html>
